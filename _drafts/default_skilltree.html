<!DOCTYPE html>
<html>

<head>
  {% seo %}
  {% include common-head.html %}
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <script src="\assets\mermaid.js\mermaid.min.js"></script>
</head>

<script>
//渲染頁面資訊
document.addEventListener("DOMContentLoaded", function(){
  var div = document.getElementById('post_right_main');
    var createHtml = '<div class="mermaid" markdown="0" > \n';
    createHtml += 'packet-beta \n';    
    var tagArray = [];
    var tagDictionary = {};
    {% for post in site.posts %}
       {% for tag in post.tags %}
          tagItem = '{{ tag }}';
          
          //Dictionary
          if(tagArray.indexOf(tagItem) === -1)
          {
            tagArray.push(tagItem);
            tagDictionary[tagItem] = tagItem.length;        
          }
       {% endfor %}
      
    {% endfor %};

    let currentPackageIndex = 0;
    let moveIndex = 0;
    let blockSize = 32;
    tagArray.forEach(tagItem =>{
        let pedSize = (tagDictionary[tagItem] % 8 === 0) ? tagDictionary[tagItem] / 8 : Math.floor(tagDictionary[tagItem] / 8) + 1;

        let remind = (currentPackageIndex + 1) % blockSize;
        if((remind + pedSize) > blockSize)
        {
           moveIndex = (blockSize - remind) + pedSize;
        }
        else
        {
          moveIndex = pedSize + currentPackageIndex;
        }

        createHtml += currentPackageIndex + '-' + moveIndex + ':' + ' "' + tagItem + '" \n';        
        currentPackageIndex = moveIndex + 1;
    });
    createHtml += '</div>';
    debugger;
    // createHtml += '<div class="mermaid" markdown="0" >' + '\n' +
    //               'graph TD \n' +
    //               'A[Client] -->|tcp_123| B(Load Balancer) \n' +
    //               'B -->|tcp_456| C[Server1] \n' +
    //               'B -->|tcp_456| D[Server2] \n' +
    //               '</div>';

    /*
        <div class="mermaid" markdown="0" >
        packet-beta
        0-15: "Source Port"
        16-31: "Destination Port"                
        32-33: "12345678"
        34-39: "1"
        40-63: "工程師測試"                
    </div>
    

    */
    div.innerHTML = createHtml;
    //mermaid.init(undefined, div.querySelectorAll('.mermaid'));
});

//展開縮放Tr項目
function CollapseTableTr(trName)
{
    var trList = document.getElementsByName(trName);
    var useDisplayStyle = "";
    
    if(trList[0].style.display == "")
    {
        useDisplayStyle="none";
    }
    
    (trList).forEach(trItem => {
            trItem.style.display = useDisplayStyle;
    });
}

</script>

<body>
  {% include common-menu.html %}

  <!--固定視窗-->
  <div class="my-4"> 
  </div>
  <div class="container my-4">    
    <div class="row">
      <!-- 左側 -->
      <div></div>
      <!--右側-->
      <div id="container_right_menu" class="col-sm-11">
        <div class="gridmag-grid-post my-1">
          <h2 class="gridmag-grid-post-title">
            <a class="h2" href="javascript:void(0);" onclick="window.history.back()" rel="bookmark">{{ page.title }}</a>
          </h2>

        </div>
        <div id="post_right_main">
            <!--此為Template 會被Js替換-->  
        </div>
      </div>

    </div>
  </div>
</body>

</html>
