---
layout: default_post
title: "0096. ASP.NET Core + Docker 環境變數金鑰管理：用 Jenkins 實現權限分離與 Secrets 注入"
excerpt: "C# 學習筆記"
tags: 
- "Docker"
- "Docker-Compose"
- "Container"
- "Ubuntu"
- "Linux"
---

<div class="summary">
<br/>應用所需：1. Linux Ubuntu (本篇 22.04)
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 已安裝 Docker
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;3. 已安裝 Jenkins
<br/>解決問題：1. 說明實際生產 IT 人員如何保管金鑰，與開發人員如何使用此金鑰(不知道真實金鑰的情況)Hash 加密結果
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 如何從 Jenkins 部署 Container 並且注入金鑰參數，讓 ASP.NET C# 代碼可以讀取，並且展示 
<br/>範例專案：<a href="https://github.com/gotoa1234/MyBlogExample/tree/main/GetDockerContainerEnviromentParameterExample/GetDockerContainerEnvironmentParameterExample">範例代碼</a>
<br/>基本介紹：本篇分為 4 部分。
<br/>第一部分：金鑰管理架構 & 解決問題
<br/>第二部分：專案架構
<br/>第三部分：代碼說明
<br/>第四部分：DEMO 成果 - Jenkins & Docker 的部署

</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>

<h1>第一部分：金鑰管理架構 & 解決問題</h1>

<h2>Step 1：Kafka 適合主主架構簡介</h2>
有以下 Kafka 本身的特性，因此適合主主服務，其中最關鍵的是粗體字的部分。


<br/> <img src="/assets/image/LearnNote/2025_07_05/xxx.png" alt="" width="100%" height="100%" />
<br/><br/>


<h1>第二部分：專案架構</h1>

<h2>Step 1：範例專案架構</h2>

打開<a href="https://github.com/gotoa1234/MyBlogExample/tree/main/KafkaMultiMasterServerExample">範例代碼</a>後，架構基本分成以下：
<br/>備註：此專案有參考此<a href="https://github.com/gotoa1234/MyBlogExample/tree/main/KafkaAspCoreWebExample">專案代碼</a>，因此不用重新實作 Kafka 

{:class="table table-bordered"}
| 1. Service - BackGround | ： | 背景服務，持續輪詢 Kafka 持續消費指定的 TopicName 並使用共同的 ConsumerGroup 進行消費訊息 | 
| 2. Web 控制器  | ： | 參考專案後，需將 HomeController 改名成另一個名稱，避免衝突 | 
| 3. 初始化配置  | ： | 基本的依賴注入，並且引用 Kafka Confluent 套件，並註冊背景服務  | 

<br/> <img src="/assets/image/LearnNote/2025_07_05/xxx.png" alt="" width="100%" height="100%" />
<br/><br/>




<h1>第三部分：代碼說明</h1>

<h2>Step 1： Service - BackGround</h2>

<br/><br/>



<h1>第四部分：DEMO 成果 - Jenkins & Docker 的部署</h1>

<h2>Step 1：預期結果</h2>
每個生產者消息會分配到每個主服務器上進行消費，讓 A , B 服務器都可收到資料，並且不會重複執行。
<br/> <img src="/assets/image/LearnNote/2025_07_05/xxx.png" alt="" width="100%" height="100%" />
<br/><br/>


<h1>第五部分：DEMO 成果 - Github & Gitlab 的部署</h1>

<h2>Step 1：預期結果</h2>
當一條消息在主服務器 A 時，若異常會讓主服務器 B 進行消費。 (左 -> 右)
<br/> <img src="/assets/image/LearnNote/2025_07_05/xxx.png" alt="" width="100%" height="100%" />
<br/><br/>
