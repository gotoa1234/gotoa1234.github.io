---
layout: default_post
title: "0073. RabbitMQ 生產者-消費者模式下 & 如何使用 RabbitMQ 內建負載平衡進行推送 "
excerpt: "C# 學習筆記"
tags: RabbitMQ .netCore Web
---

<div class="summary">
<br/>注意事項2：此篇範例是將套件安裝在同一個Server下
<br/>應用所需：1. 已架設好 RabbitMQ 主機
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. Visual Studio 2022 Asp.net Core
<br/>解決問題：架設 Ubuntu 主機上的 GrayLog Server 收集Log
<br/>相關參考：<a href="https://gotoa1234.github.io/2022/05/18/1.html">0029. Windows作業系統架設 RabbitMQ 的流程</a>
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;<a href="https://gotoa1234.github.io/2022/05/22/1.html">0030. RabbitMQ生產者與消費者範例說明</a>
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;<a href="https://gotoa1234.github.io/2024/06/16/1.html">0068. SignalR 橫向擴展部署 Server - RabbitMQ Backplane 解決方案</a>
<br/>基本介紹：本篇分為四大部分。
<br/>第一部分：RabbitMQ 負載平衡原理
<br/>第二部分：Web專案架構
<br/>第三部分：代碼解析
<br/>第四部分：DEMO 驗證成果

</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>


<br/><br/>
<h1>第一部分：RabbitMQ 負載平衡原理</h1>

<h2>Step 1：安裝Java 1.8.0</h2>
Elasticsearch 依賴於Java套件，需要先安裝Java
<br/>進入Ubuntu 後輸入以下：

``` bash
sudo apt install openjdk-8-jdk-headless
```

<br/> <img src="/assets/image/LearnNote/2024_09_28/001.png" width="70%" height="70%" />
<br/><br/>


<br/><br/>
<h1>第二部分：Web專案架構</h1>

<h2>Step 1：前言</h2>
<br/> <img src="/assets/image/LearnNote/2024_09_28/001.png" width="70%" height="70%" />
<br/><br/>


<h2>Step 2：範例專案架構</h2>
<br/>

{:class="table table-bordered"}
| 1. RabbitMQ | ： | 實現生產者、消費者與共用的工廠方法 | 
| 2. 假資料庫  | ： | 為了方便說明，利用 Singleton 保存記憶體的資料，偽裝成資料庫，並提供訂單格式 | 
| 3. Service  | ： | 實現會員訂單 CRUD  | 
| 4. SignalR Hub  | ： | SignalR Hub 開出的接口，並且提供前端 Publish 與後端 Subscribe | 
| 5. 前端頁面  | ： | 提供聊天室註冊 SignalR 並且可發送訊息，與接收訊息功能 | 
| 6. 配置  | ： | 每個 Server 為了辨識，增加自己的代號、使用的 Port 號、RabbitMQ Server 位置 | 
| 7. 初始化配置  | ： | 依賴注入 SiganlR、RabbitMQ、背景服務 | 


<br/> <img src="/assets/image/LearnNote/2024_06_16/002.png" width="50%" height="50%" />
<br/>



<br/><br/>
<h1>第三部分：代碼解析</h1>

<h2>Step 1：添加 MongoDB 軟件</h2>
安裝 MongoDB 需將此軟體添加到 Ubuntu 的列表中，版本 6.0
<br/>Ubuntu 輸入以下：

``` bash
echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
```

<br/> <img src="/assets/image/LearnNote/2024_09_28/001.png" width="70%" height="70%" />
<br/><br/>



<h1>第四部分：DEMO 驗證成果</h1>

<h2>Step 1：添加 MongoDB 軟件</h2>
安裝 MongoDB 需將此軟體添加到 Ubuntu 的列表中，版本 6.0
<br/>Ubuntu 輸入以下：

``` bash
echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
```

<br/> <img src="/assets/image/LearnNote/2024_09_28/001.png" width="70%" height="70%" />
<br/><br/>
