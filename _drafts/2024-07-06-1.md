---
layout: default_post
title:  "0069. GrayLog 空間配置、自定義查詢欄位"
excerpt: "C# 學習筆記"
tags: C# .Net Core Nginx SignalR RabbitMQ Linux Ubuntu 
---
<div class="summary">
<br/>應用所需：1. 一台已架設好的 GrayLog Server 可參考<a href="https://gotoa1234.github.io//2023/10/28/1.html">此篇</a>
<br/>解決問題：限制 GrayLog 使用磁碟空間 & 自定義想顯示的欄位
<br/>範例檔案：<a href="https://github.com/gotoa1234/MyBlogExample/tree/main/GrayLogSendLogExample">範例檔案</a> 
<br/>基本介紹：本篇分為三大部分。
<br/>第一部分：GrayLog 確認空間 & 刪除占用索引
<br/>第二部分：GrayLog 索引策略配置
<br/>第三部分：GrayLog 自定義欄位

</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>
<h1>第一部分：GrayLog 確認空間 & 刪除占用索引</h1>

<h2>Step 1：前言 - 硬碟空間不足</h2>
使用 GrayLog 如果在硬碟空間小的環境上，若沒有對 GrayLog 做空間配置設定
<br/>實務上 50G 的小硬碟空間，再過不久空間滿了，會造成 Server 異常：

``` bash
df -h
```

<br/> <img src="/assets/image/LearnNote/2024_07_06/001.png" width="50%" height="50%" />
<br/>

<h2>Step 2：如何定位是 GrayLog - 查詢Port - 1</h2>
可進入遠端機器，此目錄下，開啟 elasticsearch.yml ：

``` Markdown
/etc/elasticsearch/
```

<br/> <img src="/assets/image/LearnNote/2024_07_06/002.png" width="50%" height="50%" />
<br/>

<h2>Step 3：如何定位是 GrayLog - 查詢Port - 2</h2>
開啟 elasticsearch.yml，可以確認 Port 號的地方，若是預設的會為 9200 
<br/>※ # 表示未設定預設就是用 9200
<br/> <img src="/assets/image/LearnNote/2024_07_06/003.png" width="50%" height="50%" />
<br/>


<h2>Step 4：如何定位是 GrayLog - 查詢占用空間</h2>
可進入 GrayLog Server 輸入指令查詢

``` bash
curl -X GET "localhost:9200/_cat/indices?v"
```

<br/>對於 50G 的小機器，佔了大量的硬碟空間，並且是 graylog_4 索引集佔了大量空間
<br/> <img src="/assets/image/LearnNote/2024_07_06/004.png" width="50%" height="50%" />
<br/>

<h2>Step 5：如何定位是 GrayLog - 刪除索引</h2>
以 graylog_4 為例，輸入以下指令，可以直接對其刪除：
<br/>※需確保 Log 不需要才移除，此為真實刪除

``` bash
curl -X DELETE "localhost:9200/graylog_4"
```

<br/>對於 50G 的小機器，佔了大量的硬碟空間，並且是 graylog_4 索引集佔了大量空間
<br/> <img src="/assets/image/LearnNote/2024_07_06/005.png" width="50%" height="50%" />
<br/>


<h2>Step 6：完成</h2>
刪除後，再次輸入指令查看硬碟空間，可以發現空間釋放 40% 

``` bash
df -h
```

<br/> <img src="/assets/image/LearnNote/2024_07_06/005.png" width="50%" height="50%" />
<br/>



<h1>第二部分：GrayLog 索引策略配置</h1>

<h2>Step 1：索引策略配置 - 1</h2>
進入 GrayLog WebUI 介面 -> 
<br/> <img src="/assets/image/LearnNote/2024_07_06/001.png" width="50%" height="50%" />
<br/>

``` json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "Graylog": {
    "Host": "192.168.1.100",
    "Port": 12201,
    "Application": "GrayLogSendLogExample"
  },
  "AllowedHosts": "*"
}

```

``` C#
.Enrich.WithProperty("application", builder.Configuration.GetValue<string>("Graylog:Application", string.Empty))
```


<h1>第三部分：GrayLog 自定義欄位</h1>

<h2>Step 1：前言</h2>
<br/> <img src="/assets/image/LearnNote/2024_07_06/001.png" width="50%" height="50%" />
<br/>

