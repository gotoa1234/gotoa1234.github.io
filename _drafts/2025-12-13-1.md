---
layout: default_post
title:  "0023. NAS 進階使用 - Synology NAS 打造完全免費的私人知識庫： 從 Docker 安裝到使用 Tailscale Funnel 免費域名對外開放,一次搞定! "
excerpt: "資訊筆記"
tags: 
- "NAS"
- "Synology"
- "Linux"
- "Tailscale"
- "Tailscale Funnel"
- "Docker"
- "Docker-Compose"
- "Container"
- "BookStack"
- "MariaDB"
- "LinuxServer.io"
- "Portaniner"
---

<div class="summary">
<br/>應用所需：1. Synology NAS 主機(Linux 作業系統 + DSM 7.1 以上版本)
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 已安裝 Docker-Compose (Docker ≥ 20.x（rootful）、docker‑compose ≥ v2)
<br/>解決問題：1. 透過搭建 BookStack 來說明如何將 NAS 上的 BookStack 透過 Tailscale Funnel 免費域名，安全地(Https)於網際網路上公開訪問 NAS 內的 BookStack
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 說明使用 Tailscale Funnel 前，要先安裝 Tailscale 於 NAS 上的步驟 & 如何啟用
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;3. 克服權限、故障排除等，安裝過程中遭遇的問題，解決方法
<br/>相關參考：<a href="https://gotoa1234.github.io/2025/07/26/1.html">0017. LinuxServer.io 實戰：Deploy BookStack + MariaDB with Docker Compose</a>
<br/>基本介紹：本篇分為 5 大部分。
<br/>第一部分：NAS 上安裝 Bookstack 流程
<br/>第二部分：NAS 上啟用 Tailscale 與設定使用
<br/>第三部分：啟用 Tailscale Funnel 獲取免費公開域名
<br/>第四部分：DEMO 成果
<br/>第五部分：補充遭遇問題

</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>
<h1>第一部分：NAS 上安裝 Bookstack 流程</h1>

<h2>Step 1：安裝 Docker</h2>
登入 NAS -> 套件中心 -> 安裝 Docker 
<br/>補充：建議 NAS 安裝 Docker 透過套件中心安裝，可以有廠商保證的 **官方支援、最穩定** ，因為廠商會符合 DSM 支援的版本
<br/>自行透過 SSH 安裝 Docker 可能會有版本與 DSM 不匹配的異常狀況
<br/> <img src="/assets/image/Infomation/2025_12_13/001.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：開啟 NAS SSH 通道</h2>
官方套件中心下載的 **Docker BookStack Image** 缺少些設定關鍵值，因此我們要透過 SSH 進行安裝
<br/> <img src="/assets/image/Infomation/2025_12_13/002.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 3：遠端登入 NAS</h2>
可透過 mRemoteNG 或其他遠端訪問軟體，對 NAS Linux 系統訪問
<br/>登入後，輸入以下指令，檢查權限：

``` Shell
docker ps -a
```

<br/> <img src="/assets/image/Infomation/2025_12_13/003.png" alt="" width="50%" height="50%" />
<br/><br/>
<br/>若確定出現 **permission denied** 表示當前登入的帳號權限不足，我們要暫時性的提升訪問 docker 權限 (要安裝 BookStack 使用)
<br/>輸入以下：

``` Shell
sudo chmod 666 /var/run/docker.sock
```

<br/>並且輸入密碼後，即可暫時性的提供對 docker 的操作
<br/> <img src="/assets/image/Infomation/2025_12_13/003_2.png" alt="" width="50%" height="50%" />
<br/><br/>

 
<h2>Step 4：檢查 Docker 資料夾</h2>
回到 NAS 管理介面 -> 控制台 -> 共用資料夾
<br/>可以看到自己的 **docker** 資料夾位置，後續相關的 docker-compose.yml 都會放置於此
<br/> <img src="/assets/image/Infomation/2025_12_13/004_0.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 5：新增 yml 安裝 bookstack</h2>
如下圖，我們在 docker 目錄中，新增 **docker-compose.yml** 檔案
<br/>詳細的安裝內容、腳本可參考文章： <a href="https://gotoa1234.github.io/2025/07/26/1.html#h1_2">實戰部署 BookStack +  MariaDB</a>
<br/> <img src="/assets/image/Infomation/2025_12_13/004.png" alt="" width="50%" height="50%" />
<br/><br/>



<h2>Step 6：安裝完成</h2>
準備好腳本，並且輸入以下指令後(包含 APP_KEY 設定)：

```
docker-compose up -d
```

<br/>為了方便 Demo 安裝了 Portainer 說明，如下圖，bookstack + mariadb 已在 NAS 上安裝完成
<br/> <img src="/assets/image/Infomation/2025_12_13/005.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 7：確認 BookStack Web-UI </h2>
若有使用 Tailscale 並且登入成功，可以透過直通 NAT 從自己的機器訪問：

``` html
http://100.92.58.167:6875/login
```

<br/>但目前只確認有開通，我們目的是此網站可以讓網際網路上的所有人訪問，還需要後續的步驟實現。並且 **不額外花費金錢** 達成目標。
<br/> <img src="/assets/image/Infomation/2025_12_13/006.png" alt="" width="50%" height="50%" />
<br/><br/>




<br/><br/>
<h1>第二部分：NAS 上啟用 Tailscale 與設定使用</h1>

<h2>Step 1：Tailscale 基本介紹</h2>
訪問<a href="https://tailscale.com/">Tailscale官網</a>有以下介紹：

``` Markdown
Tailscale is a secure and private, 
identity-based, 
infrastructure agnostic network with a flexible topology, 
resilient networking, and a streamlined setup.
```

<br/>大意是說：可以打造安全、私密的自己的網路拓樸
<br/>更通俗的解讀： **Tailscale 可以非常輕鬆地把你所有裝置（NAS、Windows、Mac、手機、伺服器），連接成一個安全的私人網路**
<br/> <img src="/assets/image/Infomation/2025_12_13/007.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：Tailscale 解決網路配置問題</h2>
關鍵的是能讓裝置間可以點對點直接訪問，解決了以下網路問題：

{:class="table table-bordered"}
| 不用設定路由器 |
| 不用 Port Forward |
| 不用 DDNS |
| 不用自己架 VPN Server |
| 多裝置跨家裡 / 全世界也能互相連線 |
| 穿透 NAT、穿透防火牆 |
| 一鍵連線、全自動加密、高安全性 |

<br/><br/>

<h2>Step 3：Tailscale 的工作原理</h2>
至於原理如何實現 NAT 穿透，詳細可以參考<a href="https://tailscale.com/blog/how-tailscale-works">官方的說明</a>

{:class="table table-bordered"}
| 1. WireGuard 加密通道 | Tailscale 的資料傳輸是靠 WireGuard tunnel |
| 2. NAT 穿透技術 | 採用 ICE/STUN/TURN 類似技術，進行 UDP Hole Punching (兩台在 NAT 後面的裝置主動對外傳一包 UDP) |
| 3. Tailscale 控制平面 | 用戶登入平台後，每個節點會從控制平面拿到私有的訪問所需資料(IP、Public Key、ACL、NAT穿透資訊等...) | 

<br/> <img src="/assets/image/Infomation/2025_12_13/008.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 4：Tailscale 缺點</h2>
雖然 Tailscale 解決了傳統的 VPN 所需克服的網路問題，但就是因為克服了，而有些問題點必須知道：

{:class="table table-bordered"}
| 1. 依賴 Tailscale 的控制平面（SaaS 雲服務） | 如果 Tailscale 官方宕機，你的裝置可能無法新增、登入或更新路由 (企業要 100% 可用的情況，下不能全部依賴) |
| 2. 公司無法有效控管 | 能穿透 NAT、防火牆、企業 Proxy，換句話說穿透了 **公司安全部門** ，會繞過企業限制，會導致企業無法控管網路，造成安全性問題。 |
| 3. 需要信任 Tailscale 官方的金鑰管理 | 雖然官方保證極度重視隱私，但不能保證未來政策方針變更後，會導致資料外洩 | 
| 4. 部分網路環境下會退回走 DERP(網速變慢) | 發生在雙方機器點對點不相容、防火牆嚴格的狀況下，會走 DERP (TCP Relay Server)，網路速度因此變慢 | 
| 5. Mesh 網路規模大時，ACL 設定會變複雜 | ACL 變大的同時，會導致路由器分發同步複雜，因此會導致網路變慢(需解析) | 
| 6. 低延遲的狀況不適合 | 高頻率 UDP（遊戲伺服器）、傳大型檔案、高頻交易的資料庫等，低延遲的情境下使用 Tailscale 會因此被網路拖慢。  | 

<br/>綜上所述，Tailscale 通常適合 **一般工程師 / 家庭用 / 自己的 NAS (小團隊、私人用途內部網路使用)**
<br/><br/>

<h2>Step 5：Tailscale 收費方式 - 個人版免費</h2>
以下是<a href="https://tailscale.com/pricing">官方收費的方式</a>，個人版目前註冊後，仍有 3 個核心使用者數為免費的，個人使用支持 100 個設備，是相當夠用的。
<br/>補充：核心使用者表示的是註冊的主帳號，可以再分享給另外 2 個帳號，另外 2 個帳號都可以訪問主帳號的裝置

{:class="table table-bordered"}
| 方案名稱  | 價格／月 | 適用對象 | 核心使用者數 | 裝置數量限制 | 主要差異特色 |
| --- | --- | --- | --- | --- | --- |
| **Personal（個人免費版）**  | 0 | 個人、家庭使用 | 最多 3 人（使用者）| 最多 100 裝置 | 免費使用，不做為商業用途。|
| **Personal Plus** | 5 美金（固定） | 個人＋家庭朋友群組 | 最多 6 人 | 最多 100 裝置 | 比免費版多一點使用者數。 |
| **Starter（商業入門）** | 約 6 美金／活躍使用者 | 小團隊／企業初期 | 使用者人數不限（以活躍用戶計費） | 裝置上限為「100 ＋ 10 × 使用者數」 | 商業用途起點，已有較完整功能。 |
| **Premium（商業進階）** | 約 18 美金／活躍使用者 | 成長型企業、需要更高階控管 | 使用者人數不限（以活躍用戶計費）| 裝置上限為「100 ＋ 20 × 使用者數」 | 進階功能如 Funnel、SSH、完整 ACL 等。 |
| **Enterprise（企業方案）** | 自訂／請洽銷售  | 大型企業、自訂需求 | 使用者／裝置皆可自訂  | 裝置上限自訂 | 專業合規、專屬支援、大型部署。 |

<br/> <img src="/assets/image/Infomation/2025_12_13/012.png" alt="" width="50%" height="50%" />
<br/><br/>



<h2>Step 6：NAS 安裝 Tailscale</h2>
登入 NAS -> 套件中心 -> 安裝 Tailscale -> 開啟並登入
<br/> <img src="/assets/image/Infomation/2025_12_13/009.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 7：NAS 登入 Tailscale</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>




<br/><br/>
<h1>第三部分：啟用 Tailscale Funnel 獲取免費公開域名</h1>

<h2>Step 1：Tailscale Funnel 基本介紹</h2>
**Tailscale Funnel** 是 Tailscale 提供的一個功能，可以透過 **啟用** 來免費使用。
<br/>目的：**可以把NAS、家用伺服器上的服務，安全地公開到 Internet 上，而不需要設定防火牆、路由器或反向代理。**
<br/><a href="https://tailscale.com/kb/1223/funnel">官方 Tailscale Funnel 說明連結</a>
<br/> <img src="/assets/image/Infomation/2025_12_13/011.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：Tailscale Funnel 實現流程</h2>
為了讓 **私有 Tailscale 節點安全地被外網訪問**，實際上會運行以下步驟：

{:class="table table-bordered"}
| 1. 你在 Tailscale 網路內的一台機器（例如 NAS）啟用 Funnel。|
| 2. Tailscale 會建立一個 全域公開的 HTTPS 端點（例如 https://yourname.tailnet-funnel.ts.net）。|
| 3. 所有從外部 Internet 到這個網址的流量，會經過 Tailscale 的中繼伺服器，轉發到你的 NAS。|

<br/><br/>


<h2>Step 3：遠端 SSH 訪問 NAS</h2>
透過 SSH 訪問 NAS ，並且輸入以下指令進行啟動
<br/>備註：6875 是開啟 BookStack 的 Port，如果有其他容器、網站想要對外，可以再額外設定

``` Shell
sudo tailscale funnel --bg 6875
```

<br/>執行後，會出現 **Funnel is not enabled on your tailnet. To enable, visit:**
<br/>將網址貼上瀏覽器進行訪問
<br/> <img src="/assets/image/Infomation/2025_12_13/013.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 4：開啟權限</h2>
開啟瀏覽器貼上網址後，會要求進行授權，允許
<br/> <img src="/assets/image/Infomation/2025_12_13/014.png" alt="" width="50%" height="50%" />
<br/>
<br/>成功後，應出現以下畫面：
<br/> <img src="/assets/image/Infomation/2025_12_13/015.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 5：回到 NAS - 啟用完成</h2>
可以發現授權成功後，會獲得類似以下網址，這是 Tailscale Funnel 產生的域名

``` Markdown
https://{您的 NAS 域名}.tailed716c.ts.net
```

<br/> <img src="/assets/image/Infomation/2025_12_13/016.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 6：NAS 可回顧 TailScale Funnel 提供的域名</h2>
未來若是忘記已啟用的域名，可以到 NAS 上透過以下指令檢查

``` Shell
tailscale funnel status
```

<br/> <img src="/assets/image/Infomation/2025_12_13/019.png" alt="" width="50%" height="50%" />
<br/><br/>





<br/><br/>
<h1>第四部分：DEMO 成果</h1>

<h2>Step 1：原 TailScale 失效</h2>
原 TailScale 的訪問會失效，取而代之的是 TailScale Funnel 的域名取代

``` html
http://100.92.58.167:6875/login
```

<br/> <img src="/assets/image/Infomation/2025_12_13/017.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：訪問 TailScale Funnel 域名 - 成功對外</h2>
透過 Tailscale Funnel 提供的域名，我們已經可以用任何網路來訪問這個網站
<br/> <img src="/assets/image/Infomation/2025_12_13/018.png" alt="" width="50%" height="50%" />
<br/><br/>



<br/><br/>
<h1>第五部分：補充遭遇問題</h1>

<h2>Step 1：使用技巧與維護</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 1：快捷鍵與搜尋技巧</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 1：版本控制與備份方式</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 1：定期匯出 PDF / HTML</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>





<br/><br/>
<h1>第六部分：總結與建議</h1>

<h2>Step 1：不支援內部 IP 訪問 - 問題 1</h2>
<br/> <img src="/assets/image/Infomation/2025_12_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>