---
layout: default_post
title:  "0047. .Net Core 使用ImageSharp排除Linux(CentOS)伺服器字型問題"
excerpt: "C# 學習筆記"
tags: VisualStudio .netCore C# Linux CentOS
---
<div class="summary">
<br/>應用所需：1. Visual Studio 2022
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. .net core Web專案 (Website MVC示範)
<br/>解決問題：1. .netCore中使用ImageSharp套件時，如何排除字型問題
<br/>基本介紹：本篇分為二大部分。
<br/>第一部分：直接佈署問題描述
<br/>第二部分：解決方法
</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>
<h1>第一部分：直接佈署問題描述</h1>

<h2>Step 1：範例專案部署後</h2>
<br/>

<br/> <img src="/assets/image/LearnNote/2023_08_19/001.png" width="30%" height="30%" />
<br/><br/>

<br/><br/>
<h1>第二部分：解決方法</h1>

<h2>Step 1：Nuget安裝</h2>
安裝以下2個Swagger相依性套件

``` batch
Swashbukle.AspNetCore
Swashbukle.AspNetCore.Swagger
```

<br/> <img src="/assets/image/LearnNote/2023_08_19/002.png" width="75%" height="75%" />
<br/><br/>

<h2>Step 2：Program.cs設定</h2>
安裝完成Nuget後，再添加Service與Build相關Swagger相關代碼
<br/>對應專案架構的：1. 初始化

``` C#
using Microsoft.OpenApi.Models;
using System.Reflection;

var builder = WebApplication.CreateBuilder(args);

\\配置其他Service...

//1. Nuget安裝Swagger
//2-1. 增加以下代碼，啟用Swagger
builder.Services.AddSwaggerGen(o =>
{
    o.SwaggerDoc("v1", new OpenApiInfo { Title = "產生Swagger文件", Version = "v1" });
    // 2-2. 加入xml檔案到Swagger
    var xmlFile = $"{Assembly.GetExecutingAssembly().GetName().Name}.xml";
    var xmlPath = Path.Combine(AppContext.BaseDirectory, xmlFile);
    o.IncludeXmlComments(xmlPath, includeControllerXmlComments: true);
});

var app = builder.Build();

\\配置其他app configure...

if (app.Environment.IsDevelopment())
{
    //3. 只有Dev(Debug Mode)時才會啟用
    app.UseSwagger();
    app.UseSwaggerUI(c =>
    {
        c.SwaggerEndpoint("/swagger/v1/swagger.json", "My API V1");
    });
}

\\配置其他app configure...

app.Run();


```
<br/><br/>



<h2>Step 3：控制器代碼-1</h2>
以下使用HomeController.cs中，當檢視器(View)與Action(API)共存的情況下，如何出現在Swagger

``` C#
using Microsoft.AspNetCore.Mvc;

namespace NetCoreSwaggerWebSiteAdditionExample.Controllers
{
    public class HomeController : Controller
    {
        private readonly ILogger<HomeController> _logger;

        public HomeController(ILogger<HomeController> logger)
        {
            _logger = logger;
        }

        public IActionResult Index()
        {
            return View();
        }

        public IActionResult Privacy()
        {
            return View();
        }

        //1. 標記出Swagger辨識的Attributer
        [HttpGet]
        [Route("api/Home/GetPersonalInfo")]
        public IActionResult GetPersonalInfo(int userId)
        {            
            return Ok();
        }

        //2. 標記出Swagger辨識的Attributer
        [HttpPost]
        [Route("api/Home/GetDeposit")]        
        public IActionResult GetDeposit(int userId, string password)
        {
            return Ok();
        }
    }
}
```

<br/><br/>

<h2>Step 4：控制器代碼-2</h2>
標註Attribute，必須有Http的Action與指定Route，那麼Swagger才會辨識出

```
[HttpGet]
[Route("api/Home/GetPersonalInfo")]
```

<br/><br/>

<h2>Step 5：Demo成果</h2>
執行網站，並且在根目錄下追加路徑： /Swagger/index.html
<br/>就會跳轉到Swagger文件資訊頁面，可以看到Api資訊已出現

``` html
http://localhost:7206/swagger/index.html
```

<br/> <img src="/assets/image/LearnNote/2023_08_05/003.png" width="50%" height="50%" />
<br/><br/>

<!-- 
# 設定 Csproj 確保 ImageSharp使用font 
<PackageReference Include="SixLabors.ImageSharp" Version="3.0.1" />
<PackageReference Include="SixLabors.ImageSharp.Drawing" Version="1.0.0-beta15" />
<PackageReference Include="SixLabors.Fonts" Version="1.0.0-beta19" />

# 安裝依賴包
sudo yum install epel-release


# 安裝字型
sudo yum install -y curl cabextract xorg-x11-font-utils fontconfig
sudo rpm -i https://downloads.sourceforge.net/project/mscorefonts2/rpms/msttcore-fonts-installer-2.6-1.noarch.rpm


# 檢查字型
[root@DB-63 ~]# find /usr/share/fonts/ -name "arial*"

# 最後記得重啟 Service



個人信息
-->