---
layout: default_post
title:  "0019. Jenkins 舊專案搬家 + Docker 容器化教學：設定轉移 + 插件自動安裝 (可復現 Jenkins 環境, Reproducible Jenkins Environment)"
excerpt: "Jenkins"
tags: 
- "Jenkins"
- "Continuous Integration(CI)"
- "Continuous Deployment(CD)"
- "Docker"
- "Docker-Compose"
- "Container"
- "Ubuntu"
- "Linux"
---

<div class="summary">
<br/>應用所需：1. jenkins 主機
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 已安裝 Docker-Compose Ubuntu 主機 
<br/>解決問題：1. 將舊版 Jenkins (Windows)機器上的資料轉移到新機器的新版 Jenkins(Ubuntu 容器化) ，並且建議安全的做法來完整保存使用者、憑證與 Plugin 設定
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 打造可復現的 Jenins CI/CD 容器化環境，實現 Reproducible Jenkins Environment 達到任何人的機器執行容器化都有相同的 Jenkins 基本配置
<br/>範例專案：<a href="https://github.com/gotoa1234/MyBlogExample/tree/main/JenkinsDockerComposeExample">範例腳本</a>
<br/>基本介紹：本篇分為 5 大部分。
<br/>第一部分：問題描述
<br/>第二部分：各轉移項目 - 安全的做法
<br/>第三部分：舊版遷移到新版 Jenkins 
<br/>第四部分：建立可復現的 Jenkins 容器
<br/>第五部分：DEMO 成果 - 可復現容器

</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>



<br/><br/>
<h1>第一部分：問題描述</h1>

<h2>Step 1：舊版遷移到新版 Jenkins - 遭遇問題</h2>

``` C#
// 建立遷移會影響的項目
// - 描述圖片 
// - 搬遷內容
```

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>



<h2>Step 2：建立可復現的 Jenkins 容器 - 目的</h2>

``` C#
// 每次重建 Jenkins 到各處的好處
// - 如何建立
// - 基礎建設項目
```


<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>



<br/><br/>
<h1>第二部分：各轉移項目 - 安全的做法</h1>

<h2>Step 1：版本落差太大 - 跨平台遷移的風險</h2>
以下是基本跨平台 **Windows 轉移到 Linux** 上的風險差異

{:class="table table-bordered"}
| 1. 檔案路徑格式 | ： | Windows 使用 \，Linux 使用 /，某些插件或 job config.xml 會儲存硬編碼路徑。 |
| 2. 憑證加密差異 | ： | Jenkins Credentials 加密依賴 OS 上的 secrets/master.key 與環境，跨平台可能無法解密。 |
| 3. 權限問題 | ： | Windows 檔案系統權限與 Linux 完全不同，導致 container 內部讀寫異常。 |
| 4. 插件相依性 | ： | 某些插件只支援某 OS，例如某些用到 PowerShell 或 bat 的 plugin 會在 Linux 掛掉。 |
| 5. 工具安裝 | ： | 工具（JDK、Maven）若原本配置為 Windows 路徑，會在 Linux 找不到可執行檔。 |

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>



<h2>Step 2：版本落差太大 & 需遷移的內容 - 安全的作法</h2>
基於風險上的描述後，Jenkins 要搬遷從 Windows 的 Jenkins (安裝在作業系統上) 到 Linux Ubuntu 上的容器 Jenkins 
<br/>分成以下可搬移的項目，分析說明


{:class="table table-bordered"}
| 搬移項目 | 可考慮做法 | 最安全的作法 | 解釋說明 |
| ----- | ----- | ----- | ----- |
| 1. Views 視景 | **直接將 config.xml 檔案複製**  | 在新 Jenkins 上重建 | .xml 檔案會因為 Jenkins 版本差異、Plugings 套件差異而導致無法使用 |
| 2. Job 工作項目 | **手動重建** | 如左 | 很多 Plugings 套件相依於 Job 作業上，若升級導致 Plugins 失效無法安裝，會導致無法使用 |
| 3. System 配置  | **手動重建** | 如左 | Windows、Linux 的配置、路由、環境變數都不同，因此直接複製 .xml 設定檔案，會導致異常 |
| 4. Plugins 外掛插件 | **透過 plugin.txt 安裝** | 手動安裝 | 有些套件在新版 Jenknins 已不支援，並且作業系統的關係，會讓某些套件直接安裝時死亡 (EX: Windows 的 PowerShell)  |
| 5. Credentials 配置權限 | **手動重建** | 如左 | 因為 credentials.xml 與 secrets 是基於特定 OS 和 key 加密 |
| 6. Users 帳號 | **將 users 資料夾全部複製**  | 手動重建 | users.xml 加密方式會與 OS 環境有差異，會導致搬移後原本的用戶密碼無法登入，此外某些 Plugings 相依關係，不支援時直接導致異常 |
| 7. Tools 工具配置 | **DockerFile 安裝** | 下指令手動安裝 | 絕對不可以複製 .xml 因為跨平台的關係 SDK 安裝版本會有差異 ; 此外 Dockerfile 裡面安裝的套件可能會與 Jenkins & OS 版本有相依關係，也可能間接導致異常 |

<br/>跨平台的升級 Jenkins 基本上都是手動重建，只有在 **相同作業系統** 、 **相同Jenkins版本下**，複製可搬移的方案才是最有可能的
<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>



<br/><br/>
<h1>第三部分：舊版遷移到新版 Jenkins </h1>

<h2>Step 1：搬移項目說明</h2>
手動重建的項目會直接忽略，會依序對這些項目做搬移說明：

{:class="table table-bordered"}
| 1. Views 視景 | **直接將 config.xml 檔案複製**  |
| 2. Users 帳號 | **將 users 資料夾全部複製**   | 

<br/> 以下 2 項會在 **第四部分：建立可復現的 Jenkins 容器** 說明：

{:class="table table-bordered"}
| 1. Plugins 外掛插件 | **透過 plugin.txt 安裝** |
| 2. Tools 工具配置 | **DockerFile 安裝**  |

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>


<h2>Step 2：Views 視景 - 將 config.xml 檔案複製</h2>

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>






<br/><br/>
<h1>第四部分：建立可復現的 Jenkins 容器</h1>

<h2>Step 1：執行 Docker Build Image</h2>

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>



<br/><br/>
<h1>第五部分：DEMO 成果 - 可復現容器</h1>

<h2>Step 1：執行 Docker Build Image</h2>

<br/> <img src="/assets/image/ContinuousDeployment/Jenkins/2025_07_12/001.png" alt="" width="100%" height="100%" />
<br/><br/>

