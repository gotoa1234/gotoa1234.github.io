---
layout: default_post
title: "0010. Portainer 的進階使用 - 適合初學者的 Docker 管理工具"
excerpt: "Docker"
tags: 
- "Docker"
- "Container"
- "Portainer"
- "Ubuntu"
- "Linux"
---

<div class="summary">
<br/>應用所需：1. 已安裝 Portainer
<br/>解決問題：Portainer 管理上的應用 & 定位 & 快速用法
<br/>相關參考：<a href="https://gotoa1234.github.io/2024/05/12/1.html">0002. Ubuntu 上使用 Docker 管理工具 Portainer </a>
<br/>基本介紹：本篇分為 5 部分。
<br/>第一部分：Portainer 前言 - 適用對象 & 本篇摘要
<br/>第二部分：使用者與群組權限設定
<br/>第三部分：連接多台機器的環境管理
<br/>第四部分：應用模板 (App Templates)
<br/>第五部分：Stack 管理
</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>
<h1>第一部分：Portainer 前言 - 適用對象 & 本篇摘要</h1>

<h2>Step 1：本篇前言、目標</h2>
對許多剛接觸 Docker 的開發團隊來說，CLI 指令操作門檻高、錯誤難以排查，是導入容器化的第一道障礙。
<br/>Portainer 作為一款輕量級的 Docker 可視化管理工具，提供直覺的網頁介面，讓用戶能夠輕鬆部署應用、管理權限、監控節點狀態，甚至跨主機操作容器。
<br/>而在免費的 CE 版本中，也包含了許多足以應對中小型開發需求的實用功能。

<br/><br/>


<h2>Step 2：本篇目標</h2>
本篇文章旨在介紹 Portainer CE (Community Edition) 的幾個核心功能，包含以下功能：

{:class="table table-bordered"}
| 項目  | 說明 |
| ----- | ---- |
| 1. 連接多台機器的環境管理 | 示範如何將多台 Docker 主機（本地或遠端）加入 Portainer 的環境中集中管理，適合有多節點需求的小型開發或測試團隊使用。 |
| 2. 使用者與群組權限設定 | 介紹 Portainer CE 中的使用者與群組管理機制，並說明在 CE 版本下如何進行基本的角色分工與存取控制，CE 主要用於訪問多台機器的檢視。 |
| 3. 應用模板 (App Templates) | 解說如何使用 Portainer 提供的預設應用模板快速部署常用應用，以及自訂模板的建立方式，加速開發測試環境的搭建流程。 |
| 4. Stack 管理 | 說明如何透過 Portainer 建立、部署與管理 Docker Stack，包括 YAML 編排、環境變數設置與服務版本控制，讓多容器應用可以更有條理地管理。 |

<br/>**最終目標**：讓讀者了解如何使用 Portainer 提升容器部署與管理的效率，並協助團隊在不熟悉指令操作的情況下，**快速上手 Docker 生態系**。
<br/><br/>


<h2>Step 3：適用群體、對象</h2>
本篇主要適用的對象如下，適合團隊剛開始導入 Docker 容器管理工具時參考。

{:class="table table-bordered"}
| 1. Docker 有基本認識，但不熟悉 CLI 操作的開發者  |
| 2. 希望建立簡單容器化管理介面的小型或中型團隊     |
| 3. 正在尋找免費工具管理多台 Docker 主機環境的 IT 或 DevOps 工程師 |
| 4. 正在評估 Portainer 是否能作為內部部署工具的技術決策者 |

<br/><br/>


<h2>Step 4：補充 - Portainer 與建議管理 </h2>
以下是團隊與規模的初步評估，若開發團隊中有不熟悉容器化管理成員，可以採用 Portainer 讓成員快速熟悉。
<br/>待整體熟系容器化生態系後，可以逐步減少 Portainer 的依賴。

{:class="table table-bordered"}
| 團隊屬性                    | 建議管理方式                                                     |
| ----------------------- | ---------------------------------------------------------- |
| 新創 / 團隊小 / 成員不熟 Docker  | ✅ Portainer Template + Webhook                             |
| 中大型團隊 / DevOps 團隊健全     | ✅ Jenkins + GitOps / SSH 部署                                |
| 混合團隊（部分人 DevOps，部分人偏開發） | ✅ Portainer + Jenkins 整合（用 Jenkins 下達 Webhook 給 Portainer） |

<br/><br/>



<br/><br/>
<h1>第二部分：連接多台機器的環境管理</h1>

<h2>Step 1：多環境管理機器架構 & 本節目標</h2>
我們目前已在 **192.168.51.93** 安裝了 Portainer，但若有多台機器要管理話，就需要對其他機器做設定
<br/>如下圖，我們還有一台機器 **192.168.51.94** 當前已安裝了 Docker
<br/>本節目標： 192.168.51.93 可以監控 192.168.51.94 機器，可以不用登入 192.168.51.94 就能觀察到該機器的 Docker Container 狀態
<br/>※並且可以有視覺化的方式監控，對剛熟悉者較友善
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 2：設定 Enviroments</h2>
登入 Portainer -> 選擇左下角的 Settings 中的 Enviroemnt -> 選擇右上角的 Add enviroment
<br/>目前管理只有看到自己的 **local** 
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/001.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 3：選擇 Docker Standalone</h2>
進入後，選擇 **Docker Standalone** -> 選擇按鈕 Start Wizard 
<br/>目的是可以訪問另一台已安裝 Docker 的機器
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/002.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 4：設定 Agent - 複製語法</h2>
選擇 Agent -> 點擊 Copy Command 
<br/>此語法是用來安裝另一台被監控機器設定為 Agent ，使得本機的 Portainer 可以訪問被監控機器
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/003.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 5：設定 Agent - 登入被監控的機器，執行語法</h2>
將從 Portainer 複製的語法(監控機器)，貼上到另一台 **被監控**的機器 -> 執行 Shell 腳本 -> 安裝完成
<br/>補充：若**被監控**的機器 Port:9001 已經被占用，需要調整 Port 號
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/004.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 6：設定 Agent - 貼上資訊</h2>
回到 Portainer (監控機器)，將被監控的機器資訊貼上，以當前的範例來看會是：

{:class="table table-bordered"}
| Name                    | http://192.168.51.94:9001 |
| Enviroment address      | 192.168.51.94:9001 |

<br/>填完資訊 -> 點擊 Connect 
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/005.png" alt="" width="50%" height="50%" />
<br/>
<br/>添加完成：
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/006.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 7：連接多台機器的環境管理 - 嘗試訪問</h2>
最後回到 Enviroment 頁面，就會出現被監控機器的資訊，我們點擊進入 **http://192.168.51.94:9001** 
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/007.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 8：連接多台機器的環境管理 - 完成</h2>
進入後可以訪問到遠端的被監控機器，為了方便驗證，從 192.168.51.94 也安裝 Portainer 進行比對，容器資訊會是一致
<br/>未來只要一台機器安裝 Portainer 就可以監控多台遠端安裝 Docker 的機器
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/008.png" alt="" width="50%" height="50%" />
<br/><br/>


| 2. 使用者與群組權限設定 | 介紹 Portainer CE 中的使用者與群組管理機制，並說明在 CE 版本下如何進行基本的角色分工與存取控制，CE 主要用於訪問多台機器的檢視。 |

<br/><br/>
<h1>第三部分：使用者與群組權限設定</h1>
<br/>


<h2>Step 1：Portainer CE 限制 & 本節目標</h2>
如果使用 Portainer Community Edition(社群免費版本)，在帳戶與權限設定中有以下限制：
<br/>簡言之，CE 版本無法到細部的權限、管理設定
<br/>本節目標：設定使用者權限，並達到開放可監控指定單一機器 (這裡用 192.168.51.94 可訪問 ; 但 192.168.51.93 不可訪問)

{:class="table table-bordered"}
| 功能           | 是否可用於 Portainer CE       |
| -------------- | ------------------------ |
| 建立多個使用者帳號      | ✅                        |
| 指定團隊只能存取某一主機   | ✅                        |
| 控制誰可以部署 Stack  | 🚫                       |
| 限制使用者只能查看容器    | 🚫                       |
| 自訂操作權限（如不允許刪除） | 🚫                       |

<br/><br/>



<h2>Step 2：建立 User</h2>
左邊 Menu 選擇 Users -> Add User 資訊填入 -> Create User -> 建立完成
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/009_0.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 3：建立 Team</h2>
左邊 Menu 選擇 Teams -> Add a new team 資訊填入 -> Create team -> 建立完成
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/009.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 4：設定 User 所屬 Team - 進入 Team 內容</h2>
左邊 Menu 選擇 Teams -> 拉到畫面最下方 -> 選擇剛剛建立好的 **Team** -> 進入
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/010.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 5：設定 User 所屬 Team - 添加 User</h2>
進入後 -> 左下方將需要添加到此 Team 的 User -> 選擇 **+Add**
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/011.png" alt="" width="50%" height="50%" />
<br/>
<br/>並且添加後會轉移到 **Team Members**
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/012.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 6：設定帳號訪問機器權限 - 進入管理</h2>
左邊選擇 Enviroment -> 出現當前所有的機器清單 -> 選擇 192.168.51.94:9001 這台機器(被監控機器) -> 選擇 **Manage Access**
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/015.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 7：設定帳號訪問機器權限 - 設定帳號或群組</h2>
進入管理介面，可以選擇以群組為單位的 **組名稱** ; 或者以單一用戶為單位的 **用戶名**，這邊可進行添加
<br/>※添加後該用戶才會有訪問該機器的權限
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/016_001.png" alt="" width="50%" height="50%" />
<br/>
<br/>添加後如下畫面：
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/016.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 8：使用者與群組權限設定 - 目標完成</h2>
我們以剛剛新建的帳號進行登入 192.168.51.93 (監控機器) 
<br/>可以看到只能訪問 **192.168.51.94:9001** 被監控機器，與 Step 6. 設定相呼應
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/017.png" alt="" width="50%" height="50%" />
<br/><br/>






<br/><br/>
<h1>第四部分：應用模板 (App Templates)</h1>

<h2>Step 1：快速部署預設的容器 & 本節目標</h2>
為了使用者友善， Portainer 提供常用的預設模板，讓使用者可以很輕鬆的建立容器，不用下任何指令
<br/>本節目標： 可以快速運行 Mysql 容器 (還有很多，以 Mysql 資料庫舉例)，以及建立自訂模板
<br/><br/>

<h2>Step 2：增加應用模板</h2>
進入一台機器後(這裡登入監控機，local) -> 左邊選擇 App Templates -> 選擇 Mysql  
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/019.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 3：增加應用模板 - Deploy</h2>
填入此容器的名稱 -> 選擇 Deploy -> Mysql 資料庫的容器就建立完成了
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/020.png" alt="" width="50%" height="50%" />
<br/>
<br/>補充：若想要避免 Port 衝突可以調整宿主機與容器的對應 Port 號
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/020_2.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 4：增加應用模板 - 完成 </h2>
回到容器檢視，可以發現我們已快速的安裝 Mysql，但問題是預設 App Templates 不能選擇要安裝的版本
<br/>這時就需要用到 Customer App Templates 
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/021.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 5：增加客製化應用模板 - 目標安裝 Mysql 8</h2>
如果想要安裝特定版本的 Mysql 以及設定一些參數，這就需要用到 Custom Templates，會開始用到 .yml 腳本
<br/>因此此功能會是**熟悉的開發者**建立，讓**剛接觸的使用者**使用
<br/>左邊選擇 App Templates -> Custom Templates -> 並且選擇 Create Custom template  
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/022.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 6：增加客製化應用模板 - Deploy</h2>
進入後在 Title 與 Description 輸入文字，並且目前目標是 Mysql 8.0 可以使用以下的 yml 語法腳本
<br/>都完成後，拉到最下方執行 Deploy 

``` yml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    container_name: mysql8
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: MySecretPass123
      MYSQL_DATABASE: demo
      MYSQL_USER: user123
      MYSQL_PASSWORD: userpass456
    volumes:
      - /data/mysql:/var/lib/mysql
```

<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/023.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 6：增加客製化應用模板 - Create Template</h2>
進入後在 Title 與 Description 輸入文字，並且目前目標是 Mysql 8.0 可以使用以下的 yml 語法腳本
<br/>都完成後，拉到最下方執行 Cretate Template 

``` yml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    container_name: mysql8
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: MySecretPass123
      MYSQL_DATABASE: demo
      MYSQL_USER: user123
      MYSQL_PASSWORD: userpass456
    volumes:
      - /data/mysql:/var/lib/mysql
```

<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/023.png" alt="" width="50%" height="50%" />
<br/><br/>



<h2>Step 7：增加客製化應用模板 - 進入 Template</h2>
如果語法都正確，再次回到 **Customer App Templates** 會看到剛剛建立的模板，點擊進入
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/024.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 8：增加客製化應用模板 - Deploy</h2>
進入後可以直接點擊 **Deploy the Stack**
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/025.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 9：增加客製化應用模板 - Stack</h2>
我們從 **Customer App Templates** 建立的容器，會在 Stack 頁籤中統一管理，點擊檢查
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/026.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 10：增加客製化應用模板 - 完成</h2>
可以看到現在是我們客製化的 Mysql 8.0 容器，並且未來想要對容器重建，可以不需要任何指令，只需要從 GUI 介面中就可以建立。
<br/><img src="/assets/image/ContinuousDeployment/docker/2025_09_13/027.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 1：Stack</h2>
<br/> <img src="/assets/image/ContinuousDeployment/docker/2025_09_13/000.png" alt="" width="50%" height="50%" />
<br/><br/>


<br/><br/>
<h1>第五部分：Stack 管理</h1>

<h2>Step 1：說明 Stack & 本節目標</h2>
以下是 Tempalte 與 Stack 生命週期的關係：

``` Markdown
Customer Templates → 選擇範本 → 設定參數 → 部署為 Stack → 實際運行
```

| 項目 | Stack | Customer Templates |
|------|-------|-------------------|
| **性質** | 實際運行的應用程式實例 | 可重複使用的部署範本 |
| **用途** | 部署和管理容器化應用 | 建立標準化的部署模板 |
| **狀態** | 動態（運行中/停止） | 靜態（定義檔案） |


<br/><br/>

