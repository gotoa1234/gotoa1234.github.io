---
layout: default_post
title:  "0020. Jorani 安裝教學：免費開源請假管理系統 Docker 部署完整指南"
excerpt: "資訊筆記"
tags: 
- "Linux"
- "Ubuntu"
- "Docker"
- "Docker-Compose"
- "Container"
- "Jorani"
- "Nginx"
---

<div class="summary">
<br/>應用所需：1. Linux 主機(本篇 Linux Ubuntu 22.04 作業系統)
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;2. 已安裝 Docker
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;3. 已安裝 Dotnet SDK 8.0 以上版本(本篇範例使用)
<br/>&emsp;&emsp;&emsp;&emsp;&emsp;4. 已安裝 Nginx
<br/>解決問題：1. 如何快速搭建免費的請假管理系統 Jorani - 為公司省下一筆人力成本
<br/>基本介紹：本篇分為 5 大部分。
<br/>第一部分：基本介紹
<br/>第二部分：安裝與部署遇到的問題
<br/>第三部分：伺服器正確安裝 & 配置憑證
<br/>第四部分：用戶端配置
<br/>第五部分：Demo 成果
</div>

<div class="title">
    <br/><hr class="titleinner">
	<span></span>
	<hr class="titleinner"><br/>
</div>

<br/><br/>
<h1>第一部分：基本介紹</h1>

<h2>Step 1：Jorani 基本介紹</h2>
<a href="https://github.com/bbalet/jorani.git">Jorani 是 Github開源</a>的 **請假管理系統** 軟體，基於免費與開源
<br/>並且屬於 **AGPL v3 licence** 可以直接免費使用

``` Markdown
Jorani is a Leave Management System developed in PHP/MySQL under an AGPL v3 licence.
Jorani is designed to provide simple leave and overtime request workflows for small organizations.
```

<br/>簡要的說：此免費軟體需要安裝 PHP/Mysql 並適合用於中小型組織架構
<br/> <img src="/assets/image/Infomation/2025_10_25/000.png" alt="" width="50%" height="50%" />
<br/>
<br/>官方首頁<a href="https://jorani.org">https://jorani.org</a>
<br/> <img src="/assets/image/Infomation/2025_10_25/019.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：Jorani - 優缺點</h2>
Jorani 有以下優點，具備了完整請假管理系統與商業考量(免費)上的價值

{:class="table table-bordered"}
| 優點          | 說明  |
| ---------------- | --- |
| **完全免費** | 開源軟體，無需支付授權費用      |
| **低維護成本**  | 相較於商業軟體，維護成本較低     |
| **無使用者數量限制**  | 可無限制新增員工帳號     |
| **跨平台支援**      | 基於 Web 的系統，支援各種作業系統和裝置     |
| **容器化部署**      | 支援 Docker，安裝和部署相對簡單     |
| **開源透明**       | 程式碼公開，可進行安全性審查和客製化    |
| **多語言介面**       | 支援包含繁體中文在內的多種語言     |
| **功能涵蓋豐富**      | 支援複雜的組織架構和審核流程、行事曆、多層級審核、報表功能等  |

<br/>在使用時也須斟酌以下缺點：

{:class="table table-bordered"}
| 缺點          | 說明  |
| ---------------- | --- |
| **需要技術知識** | 安裝和維護需要一定的 IT 技術能力 |
| **伺服器環境要求** | 需要自行準備和管理伺服器環境 |
| **SSL 設定複雜** | HTTPS 設定對非技術人員較為困難 |
| **整合能力有限** | 與其他企業系統（如 ERP、HRM）整合較困難 |
| **工作流程彈性有限** | 複雜的審核流程設定可能受限 |
| **社群支援** | 主要依賴社群支援，官方技術支援有限、使用上很多時候需自行摸索 |
| **缺乏企業級功能** | 災難備份、單一登入整合、稽核追蹤日誌不夠完善 |

<br/><br/>


<h2>Step 3：Jorani - 完全免費與開源 & AGPL-3.0 </h2>
Jorani 是一套免費的人事/請假管理系統，官方釋出時使用 AGPL-3.0 授權。
<br/>這代表任何人都 **可以免費使用、修改、再發佈，只要遵守 AGPL 條款**，APGL 條款簡要說明：

``` Markdown
AGPL-3.0 授權條款是一種很「嚴格的自由軟體授權」，如果你用了 AGPL 授權的程式並且有修改，就要支付費用
```

<br/>但 Jroani 並無商業收費方案，只要不 **轉售**、**商業用途** 那麼都不會面臨**被提告**的風險
<br/><img src="/assets/image/Infomation/2025_10_25/018.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 4：Jorani - 應用場景與比較</h2>
適用性與應用場景比較：

{:class="table table-bordered"}
| 適用的對象 | 不適用的對象 |
| 中小型企業（50-200 人）  |  大型企業（需要複雜整合）   |
| IT 技術能力較強的組織     |  缺乏技術支援的公司(無開發人員)   |
| **預算有限**但需要數位化管理的公司      |  要深度客製化和進階功能的組織   |
| 重視資料掌控權，注重私有安全性的企業      | 對即時技術支援有強烈需求的企業(缺少SLA 保障) |

<br/>若有開發人員、並且想節省成本、又想快速上手，公司規模適中，那麼 Jorani 會是相當推薦的系統
<br/><br/>

 

<br/><br/>
<h1>第二部分：安裝與部署遇到的問題</h1>

<h2>Step 1：不支援內部 IP 訪問 - 問題 1</h2>
基於安全性的原因 Jorani 不支援 http 與 IP 直連，否則會出現錯誤：

``` Markdown
Error on first login "Uncaught (in promise) typeError: Cannot read properties of undefined (reading 'importKey')
```

<br/>
<br/>登入時會沒有任何反應
<br/> <img src="/assets/image/Infomation/2025_10_25/004.png" alt="" width="50%" height="50%" />
<br/><br/>開啟 F12 檢視瀏覽器出現錯誤訊息，這是 Jorani 基於安全性保護登入
<br/> <img src="/assets/image/Infomation/2025_10_25/005.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 2：需有域名與 SSL 憑證 - 問題 2</h2>
其次除了不支援 IP 外，訪問需要 **域名** 訪問，否則也會異常，關於此安全性解釋
<be/><a href="https://github.com/bbalet/jorani/issues/408">Jorani 相關 Issues</a>
<br/> <img src="/assets/image/Infomation/2025_10_25/006.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 3：需有域名與 SSL 憑證 - 問題 2 - 解釋</h2>
**BALET** 解釋說明強調只支援 Https
<br/>補充：如果安裝在本機用於測試可支援 Localhost，但實務上給使用者用，必需解決上述 2 個問題(域名 + SSL)
<br/> <img src="/assets/image/Infomation/2025_10_25/007.png" alt="" width="50%" height="50%" />
<br/><br/>




<br/><br/>
<h1>第三部分：如何正確的安裝 & 配置憑證</h1>

<h2>Step 1：取得 Jorani 開源代碼</h2>
先進入官網取得 .git 連結

``` Markdown
https://github.com/bbalet/jorani
```

<br/> <img src="/assets/image/Infomation/2025_10_25/001.png" alt="" width="100%" height="100%" />
<br/><br/>

<h2>Step 2：下載到部署主機</h2>
下載源代碼，並且複製到 Ubuntu 部署主機上
<br/> <img src="/assets/image/Infomation/2025_10_25/002.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 3：調整 docker-compose.yml</h2>
如果直接執行 Docker 運行，會出現第二部分的錯誤，因此我們需要調整以下 2 個參數

{:class="table table-bordered"}
| 參數 |  異動前 | 異動後 | 說明 |
| ---- | --- | --- | --- |
| **ports** | 80:80 | 8765:80 | 80 Port 很容易被占用，可以避開 |
| **BASE_URL** | 無 | https://jorani.company.local | 設定要讓使用者訪問的 url 可自定義 |

``` yml
version: '3.4'
services:
  jorani:
    build: .
    ports:
      - "8765:80"
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_DATABASE=jorani
      - MYSQL_USER=jorani
      - MYSQL_PASSWORD=jorani
      - BASE_URL=https://jorani.company.local
  mysql:
    image: mysql:8
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=jorani
      - MYSQL_DATABASE=jorani
      - MYSQL_USER=jorani
      - MYSQL_PASSWORD=jorani
    volumes:
      - ./sql/jorani.sql:/docker-entrypoint-initdb.d/jorani.sql

```

<br/> <img src="/assets/image/Infomation/2025_10_25/003_0.png" alt="" width="50%" height="50%" />
<br/><br/>


<h2>Step 4：執行 docker-compose</h2>
調整完成後，可在部署主機上運行以下指令，使其容器化運行

``` shell
docker-compose up -d
```

<br/> <img src="/assets/image/Infomation/2025_10_25/003.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 5：建立 SSL 自簽憑證 - 建立資料夾</h2>
在部署主機上，建立資料夾，並且移動到該目錄下

``` shell
mkdir -p /etc/nginx/certs
cd /etc/nginx/certs
```

<br/> <img src="/assets/image/Infomation/2025_10_25/008.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 6：建立 SSL 自簽憑證 - 新增憑證</h2>
輸入以下指令，憑證有效期為 365 天，具體依照自己需求來配置，最重要的是域名 **jorani.company.local**
<br/>必需要與 jorani 的 docker-compose.yml 一致

``` shell
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/nginx/certs/jorani.key \
  -out /etc/nginx/certs/jorani.crt \
  -subj "/CN=jorani.company.local"
```

<br/>如果是內部環境使用，其實可以設定 **-days 36500 ** 約 100 年，因為 Jorani 為內部使用，可考量方便性
<br/> <img src="/assets/image/Infomation/2025_10_25/009.png" alt="" width="100%" height="100%" />
<br/><br/>

<h2>Step 7：建立 SSL 自簽憑證 - 確認憑證</h2>
若正確產生，應可看到對應路徑下出現公開憑證 **jorani.crt** 與 私有憑證 **jorani.key**
<br/> <img src="/assets/image/Infomation/2025_10_25/010.png" alt="" width="100%" height="100%" />
<br/><br/>

<h2>Step 8：Nginx 配置</h2>
在代理伺服器方面，我們還需對 **jorani.company.local** 域名做 Nginx 配置
<br/>將 .crt .key 綁定於 443 (Https) 並且對外域名為 **jorani.company.local** 
<br/>以及 SSL 安全設定與配置 Web Crypto API 

``` Markdown
server {
    listen 443 ssl;
    server_name jorani.company.local;
    ssl_certificate     /etc/nginx/certs/jorani.crt;
    ssl_certificate_key /etc/nginx/certs/jorani.key;
    
    # 添加 SSL 安全設定
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    location / {
        proxy_pass http://192.168.51.93:8765;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        
        # 添加這些 header 解決 Web Crypto API 問題
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
    }
}

# 添加 HTTP 重定向到 HTTPS
server {
    listen 80;
    server_name jorani.company.local;
    return 301 https://$server_name$request_uri;
}
```

<br/> <img src="/assets/image/Infomation/2025_10_25/011.png" alt="" width="50%" height="50%" />
<br/><br/>




<br/><br/>
<h1>第四部分：用戶端配置</h1>

<h2>Step 1：用戶端域名配置</h2>
通常公司內部需要 IT 人員協助配置域名解析，在測試、或少數內部人員使用，更快速的解法是讓使用者 Hosts 添加域名對應
<br/>到 Windows 以下目錄

``` Markdown
C:\\Windows\\System32\\drivers\\etc
```

<br/> <img src="/assets/image/Infomation/2025_10_25/012.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：添加域名對應</h2>
開啟 Hosts 檔案， **192.168.51.93** 是我們 Jorani 的內部域名伺服器位置

``` Markdown
## Jorani ##
192.168.51.93 jorani.company.local
```

<br/><br/>




<br/><br/>
<h1>第五部分：Demo 成果</h1>

<h2>Step 1：登入 Jorani WebUI</h2>
配置完成後，可以嘗試從本機開啟瀏覽器訪問 Jorani WebUI，以下是預設帳號、密碼：

{:class="table table-bordered"}
| 帳號 | bbalet |
| 密碼 | bbalet |

``` Markdown
https://jorani.company.local
```

<br/> <img src="/assets/image/Infomation/2025_10_25/015.png" alt="" width="50%" height="50%" />
<br/><br/>

<h2>Step 2：完成</h2>
登入後就可以看到 Jorani 最高權限的 **請假管理系統** 介面
<br/> <img src="/assets/image/Infomation/2025_10_25/017.png" alt="" width="100%" height="100%" />
<br/><br/>
